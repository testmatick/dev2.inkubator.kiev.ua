<?php define("SMS_CONTROLER_URL", DIR_APPLICATION . 'model/sms/'); require_once (defined("SMS_CONTROLER_URL")?SMS_CONTROLER_URL:"") .'smsController.php'; class ControllerSmsSmscharging extends SmsController { public function index() { parent::index(); } public function display() { $i02fcabda2448d40bdb76bd10f9e95950039649ee = parent::display(); $i02fcabda2448d40bdb76bd10f9e95950039649ee .= "<script type=\"text/javascript\" src=\"" . DIR_SMS_JS . "sms.js\"></script>"; $i02fcabda2448d40bdb76bd10f9e95950039649ee .= ' <h2>' . v_smsprestashop_smscharging_h2 . '</h2> <p>' . v_smsprestashop_smscharging_description . '</p> <div> <fieldset> <legend><img src="' . self::$adminCustomerImg . '" alt="" /> ' . v_smsprestashop_smscharging_fieldset . '</legend> <table class="resultTable"> '; $idf0feb50adf373c822f952dbf828d39459fabee4 = $this->getStore(false); if(count($idf0feb50adf373c822f952dbf828d39459fabee4) > 0) { foreach($idf0feb50adf373c822f952dbf828d39459fabee4 as $i62499a8535813e85aa3b251088df3dc3b77659c5 => $ia3d7732f487de160f1fc1748a1e6b27d76a47dd7) { $i7d81a14a5090d716f9bd101fd73660f7e203a168 = false; $i83d1339527a9dc91b02fa99420eb13b0cd47adfe = $this->Execute("SELECT * FROM " . DB_PREFIX . "sp_optout_prices WHERE shop_id='" . $this->escape($i62499a8535813e85aa3b251088df3dc3b77659c5) . "'"); if($i83d1339527a9dc91b02fa99420eb13b0cd47adfe->num_rows) { foreach($i83d1339527a9dc91b02fa99420eb13b0cd47adfe->rows AS $i2e93e61d67c274d891066238c74ba6322d527b6d) { $i7d81a14a5090d716f9bd101fd73660f7e203a168 = $i2e93e61d67c274d891066238c74ba6322d527b6d["active"]; } } $i2e4fdeb098e7d0ae23dea13d874d03dd7784ea11 = ""; if($i7d81a14a5090d716f9bd101fd73660f7e203a168) { $i2e4fdeb098e7d0ae23dea13d874d03dd7784ea11 = '<span style="cursor:help;" title="' . v_smsprestashop_smscharging_optoutactive . '"><img src="' . self::$acceptImg . '" alt="' . v_smsprestashop_smscharging_optoutactive . '"/></span>'; } else { $i2e4fdeb098e7d0ae23dea13d874d03dd7784ea11 = '<span style="cursor:help;" title="' . v_smsprestashop_smscharging_optoutnotactive . '\"><img src="' . self::$denyImg . '" alt="' . v_smsprestashop_smscharging_optoutnotactive . '"/></span>'; } $i02fcabda2448d40bdb76bd10f9e95950039649ee .= ' <tr ' . self::isEven($i0018d0cb00e9a7ab65cdbd7f1c6b001b1e0222a6, "even") . '> <td><a id="displayText' . $i62499a8535813e85aa3b251088df3dc3b77659c5 . '" href="javascript:\" onclick="toggleInfo(' . htmlspecialchars($i62499a8535813e85aa3b251088df3dc3b77659c5) . ');"><img src="' . self::$plusImg . '" id="toggleButton' . $i62499a8535813e85aa3b251088df3dc3b77659c5 . '"/> ' . $ia3d7732f487de160f1fc1748a1e6b27d76a47dd7 . '</a></td> <td class="right">' . $i2e4fdeb098e7d0ae23dea13d874d03dd7784ea11 . '</td> </tr> <tr class="hidden noHover" id="toggleText' . htmlspecialchars($i62499a8535813e85aa3b251088df3dc3b77659c5) . '"> <td colspan="2">' . $this->smsOptOutForm($i62499a8535813e85aa3b251088df3dc3b77659c5) . '</td> </tr> '; } } $i02fcabda2448d40bdb76bd10f9e95950039649ee .= ' </table> </fieldset> </div> '; $i02fcabda2448d40bdb76bd10f9e95950039649ee .= " <script type=\"text/javascript\"> var minus = '" . self::$minusImg . "'; var plus = '" . self::$plusImg . "'; </script> "; return $i02fcabda2448d40bdb76bd10f9e95950039649ee; } public function smsOptOutForm($i62499a8535813e85aa3b251088df3dc3b77659c5) { $i02fcabda2448d40bdb76bd10f9e95950039649ee = ""; $i83d1339527a9dc91b02fa99420eb13b0cd47adfe = $this->Execute("SELECT * FROM " . DB_PREFIX . "sp_optout_prices WHERE shop_id='" . $this->escape($i62499a8535813e85aa3b251088df3dc3b77659c5) . "'"); $i7d81a14a5090d716f9bd101fd73660f7e203a168 = array(); if($i83d1339527a9dc91b02fa99420eb13b0cd47adfe->num_rows) { foreach($i83d1339527a9dc91b02fa99420eb13b0cd47adfe->rows as $i2e93e61d67c274d891066238c74ba6322d527b6d) { $i3da7d27ed65066b98b003daf0808f54e53cda923[$i2e93e61d67c274d891066238c74ba6322d527b6d["currency"]] = $i2e93e61d67c274d891066238c74ba6322d527b6d["price"]; $i7d81a14a5090d716f9bd101fd73660f7e203a168[$i2e93e61d67c274d891066238c74ba6322d527b6d["currency"]] = $i2e93e61d67c274d891066238c74ba6322d527b6d["active"]; } } else { $i3da7d27ed65066b98b003daf0808f54e53cda923 = array(); $i7d81a14a5090d716f9bd101fd73660f7e203a168 = array(); } $i83d1339527a9dc91b02fa99420eb13b0cd47adfe = $this->Execute("SELECT * FROM " . DB_PREFIX . "sp_optout_texts WHERE shop_id='" . $this->escape($i62499a8535813e85aa3b251088df3dc3b77659c5) . "'"); if($i83d1339527a9dc91b02fa99420eb13b0cd47adfe->num_rows) { foreach($i83d1339527a9dc91b02fa99420eb13b0cd47adfe->rows as $i2e93e61d67c274d891066238c74ba6322d527b6d) { $icdc93751c08da8107870fbae5bd9a42bf0616e96[$i2e93e61d67c274d891066238c74ba6322d527b6d["lang"]] = $i2e93e61d67c274d891066238c74ba6322d527b6d["text"]; } } $i0a3adc7f4c38171232abf754e0a5bd16e3823141 = array(); $ibf3bd608740cb14032ed20abee0eca9ab4c38081 = 0; $ia3e8dc7e3dfa147bbb4e58e1b36ea790d470231a = ""; $i83d1339527a9dc91b02fa99420eb13b0cd47adfe = $this->Execute($this->getDefaultCurrency()); if(isset($i83d1339527a9dc91b02fa99420eb13b0cd47adfe->row["store_id"])) { foreach($i83d1339527a9dc91b02fa99420eb13b0cd47adfe->rows as $i2e93e61d67c274d891066238c74ba6322d527b6d) { if($i2e93e61d67c274d891066238c74ba6322d527b6d["store_id"] == $i62499a8535813e85aa3b251088df3dc3b77659c5) { $ia3e8dc7e3dfa147bbb4e58e1b36ea790d470231a .= self::getInput(array("type" => "text", "name" => "price_" . $i2e93e61d67c274d891066238c74ba6322d527b6d["value"], "style" => "width:50px;", "value" => ((isset($i3da7d27ed65066b98b003daf0808f54e53cda923[$i2e93e61d67c274d891066238c74ba6322d527b6d["value"]])) ? ($i3da7d27ed65066b98b003daf0808f54e53cda923[$i2e93e61d67c274d891066238c74ba6322d527b6d["value"]]) : ""))) . ' ' . strtoupper($i2e93e61d67c274d891066238c74ba6322d527b6d["value"]); $i0a3adc7f4c38171232abf754e0a5bd16e3823141[] = $i2e93e61d67c274d891066238c74ba6322d527b6d["value"]; if(isset($i7d81a14a5090d716f9bd101fd73660f7e203a168[$i2e93e61d67c274d891066238c74ba6322d527b6d["value"]])) { $ibf3bd608740cb14032ed20abee0eca9ab4c38081 = $i7d81a14a5090d716f9bd101fd73660f7e203a168[$i2e93e61d67c274d891066238c74ba6322d527b6d["value"]]; } } } } else { if($i62499a8535813e85aa3b251088df3dc3b77659c5 == 0) { $i2e93e61d67c274d891066238c74ba6322d527b6d = $i83d1339527a9dc91b02fa99420eb13b0cd47adfe->row; $ia3e8dc7e3dfa147bbb4e58e1b36ea790d470231a .= self::getInput(array("type" => "text", "name" => "price_" . $i2e93e61d67c274d891066238c74ba6322d527b6d["value"], "style" => "width:50px;", "value" => ((isset($i3da7d27ed65066b98b003daf0808f54e53cda923[$i2e93e61d67c274d891066238c74ba6322d527b6d["value"]])) ? ($i3da7d27ed65066b98b003daf0808f54e53cda923[$i2e93e61d67c274d891066238c74ba6322d527b6d["value"]]) : ""))) . ' ' . strtoupper($i2e93e61d67c274d891066238c74ba6322d527b6d["value"]); $i0a3adc7f4c38171232abf754e0a5bd16e3823141[] = $i2e93e61d67c274d891066238c74ba6322d527b6d["value"]; if(isset($i7d81a14a5090d716f9bd101fd73660f7e203a168[$i2e93e61d67c274d891066238c74ba6322d527b6d["value"]])) { $ibf3bd608740cb14032ed20abee0eca9ab4c38081 = $i7d81a14a5090d716f9bd101fd73660f7e203a168[$i2e93e61d67c274d891066238c74ba6322d527b6d["value"]]; } } } ksort($i0a3adc7f4c38171232abf754e0a5bd16e3823141); $i55e9f2b841df61623ce384e384e0be7f47e8c137 = true; $i83d1339527a9dc91b02fa99420eb13b0cd47adfe = $this->Execute("SELECT * FROM `" . DB_PREFIX . "sp_config` WHERE `shop_id` = '".$this->escape($i62499a8535813e85aa3b251088df3dc3b77659c5)."' AND `config_name` = 'optout_auto'"); if($i83d1339527a9dc91b02fa99420eb13b0cd47adfe->num_rows) { foreach($i83d1339527a9dc91b02fa99420eb13b0cd47adfe->rows as $i2e93e61d67c274d891066238c74ba6322d527b6d) { $i55e9f2b841df61623ce384e384e0be7f47e8c137 = $i2e93e61d67c274d891066238c74ba6322d527b6d["config_value"]; } } $ife5dcc4866b634771ff6e888ca85e32e7f4e8fac = array(); $i6e2c90563fbddf98b6a6f3549977e76f9bfc3e3b = ' <table class="formTable"> <tbody> '; $i83d1339527a9dc91b02fa99420eb13b0cd47adfe = $this->Execute($this->getLanguages()); if($i83d1339527a9dc91b02fa99420eb13b0cd47adfe->num_rows) { foreach($i83d1339527a9dc91b02fa99420eb13b0cd47adfe->rows as $i2e93e61d67c274d891066238c74ba6322d527b6d) { $i6e2c90563fbddf98b6a6f3549977e76f9bfc3e3b .= '<tr><td>' . self::getInput(array("type" => "text", "class" => "p98", "name" => "texts_" . $i2e93e61d67c274d891066238c74ba6322d527b6d["code"], "value" => ((isset($icdc93751c08da8107870fbae5bd9a42bf0616e96[$i2e93e61d67c274d891066238c74ba6322d527b6d["code"]])) ? ($icdc93751c08da8107870fbae5bd9a42bf0616e96[$i2e93e61d67c274d891066238c74ba6322d527b6d["code"]]) : ("")))) . ' ' . $i2e93e61d67c274d891066238c74ba6322d527b6d["code"] . ' - ' . $i2e93e61d67c274d891066238c74ba6322d527b6d["name"] . ' </td></tr>'; $ife5dcc4866b634771ff6e888ca85e32e7f4e8fac[] = $i2e93e61d67c274d891066238c74ba6322d527b6d["code"]; } } $i6e2c90563fbddf98b6a6f3549977e76f9bfc3e3b .= ' </tbody> </table> '; $i02fcabda2448d40bdb76bd10f9e95950039649ee .= ' <form action="" method="post"> <table class="formTable"> <tbody> <tr> <td colspan="2" class="w100">' . self::getInput(array("name" => "prices", "type" => "checkbox", "value" => 1), $ibf3bd608740cb14032ed20abee0eca9ab4c38081) . ' ' . v_smsprestashop_smscharging_active . '</td> <td>' . v_smsprestashop_smscharging_price . '</td> <td>' . v_smsprestashop_smscharging_texts . '</td> <tr/> <tr> <td colspan="2">' .'<b>'.v_optout_auto_variable.'</b><br/>' .self::getInput(array("name" => "auto", "type" => "radio", "value" => 1), $i55e9f2b841df61623ce384e384e0be7f47e8c137)." ".v_optout_auto." <br/>" .self::getInput(array("name" => "auto", "type" => "radio", "value" => 0), (($i55e9f2b841df61623ce384e384e0be7f47e8c137)?0:1))." ".v_optout_manual .'</td> <td >' . $ia3e8dc7e3dfa147bbb4e58e1b36ea790d470231a . '</td> <td rowspan="3" class="top">' . $i6e2c90563fbddf98b6a6f3549977e76f9bfc3e3b . '</td> <tr/> <tr> <td class="right top" rowspan="2">' . self::getInput(array("type" => "submit", "name" => "submitOptOut", "class" => "button", "value" => v_adminsms_save)) . '</td> <td class="left top" rowspan="2">' . self::getInput(array("type" => "reset", "class" => "button", "value" => v_adminsms_cancel, "title" => v_adminsms_restoreunsaved)) . '</td> <td></td> </tr> </tbody> </table> ' . self::getInput(array("name" => "currenciespre", "type" => "hidden", "value" => implode("__", $i0a3adc7f4c38171232abf754e0a5bd16e3823141))) . ' ' . self::getInput(array("name" => "textspre", "type" => "hidden", "value" => implode("__", $ife5dcc4866b634771ff6e888ca85e32e7f4e8fac))) . ' ' . self::getInput(array("name" => "shop", "type" => "hidden", "value" => "$i62499a8535813e85aa3b251088df3dc3b77659c5")) . ' </form> '; return $i02fcabda2448d40bdb76bd10f9e95950039649ee; } public function postProcess($if7ac7ffb0e11bffa95681698138e923b4fd51990 = NULL, $i120dfeb2f4db76e8e52ed01ad8e678e2b9fa3bb9 = NULL, $i4df8c509b6936a0640c1594ca9b38a0a55a9562f = NULL) { if($if7ac7ffb0e11bffa95681698138e923b4fd51990 == NULL && $i120dfeb2f4db76e8e52ed01ad8e678e2b9fa3bb9 == NULL) { return self::POST_ERROR; } if(isset($i4df8c509b6936a0640c1594ca9b38a0a55a9562f['submitOptOut'])) { $ie4faac5815d93bef3c40ec90de63ed07d7f240b8 = array(); $ia3225bb1fa0556b70e4ad48c0617117b5a0606a2 = array(); $i7d81a14a5090d716f9bd101fd73660f7e203a168 = $this->escapePostVariables('prices'); $i37fb210ee0b4219df106fb552616784b077aed60 = $this->escapePostVariables('currenciespre'); $i0a1c4d03147e5cadbf95bbfff0e18f98e3c435dd = $this->escapePostVariables('textspre'); $i6815574ea6fb0d16ca760ac76ccd5e787398426b = $this->escapePostVariables('shop'); $i55e9f2b841df61623ce384e384e0be7f47e8c137 = $this->escapePostVariables('auto'); $i0a3adc7f4c38171232abf754e0a5bd16e3823141 = explode("__", $i37fb210ee0b4219df106fb552616784b077aed60); $ife5dcc4866b634771ff6e888ca85e32e7f4e8fac = explode("__", $i0a1c4d03147e5cadbf95bbfff0e18f98e3c435dd); $this->Execute("DELETE FROM " . DB_PREFIX . "sp_optout_prices WHERE shop_id = '" . $this->escape($i6815574ea6fb0d16ca760ac76ccd5e787398426b) . "'"); foreach($i0a3adc7f4c38171232abf754e0a5bd16e3823141 as $ibd0578718e12a692b299a588249092e07aac601e) { $this->Execute("INSERT INTO " . DB_PREFIX . "sp_optout_prices VALUES ('NULL', '" . $this->escape($i6815574ea6fb0d16ca760ac76ccd5e787398426b) . "', '" . trim(str_replace(",", ".", $this->escape($if7ac7ffb0e11bffa95681698138e923b4fd51990['price_' . $ibd0578718e12a692b299a588249092e07aac601e]))) . "','" . $this->escape($ibd0578718e12a692b299a588249092e07aac601e) . "','" . $this->escape($i7d81a14a5090d716f9bd101fd73660f7e203a168) . "')"); $ia3225bb1fa0556b70e4ad48c0617117b5a0606a2[$ibd0578718e12a692b299a588249092e07aac601e] = trim(str_replace(",", ".", $this->escapePostVariables('price_' . $ibd0578718e12a692b299a588249092e07aac601e))); } $this->Execute("DELETE FROM " . DB_PREFIX . "sp_optout_texts WHERE shop_id = '" . $this->escape($i6815574ea6fb0d16ca760ac76ccd5e787398426b) . "'"); foreach($ife5dcc4866b634771ff6e888ca85e32e7f4e8fac as $ibd0578718e12a692b299a588249092e07aac601e) { $this->Execute("INSERT INTO " . DB_PREFIX . "sp_optout_texts VALUES ('NULL', '" . $this->escape($i6815574ea6fb0d16ca760ac76ccd5e787398426b) . "', '" . $this->escape($if7ac7ffb0e11bffa95681698138e923b4fd51990['texts_' . $ibd0578718e12a692b299a588249092e07aac601e]) . "','" . $this->escape($ibd0578718e12a692b299a588249092e07aac601e) . "')"); $ie4faac5815d93bef3c40ec90de63ed07d7f240b8[$ibd0578718e12a692b299a588249092e07aac601e] = $this->escape($if7ac7ffb0e11bffa95681698138e923b4fd51990['texts_' . $ibd0578718e12a692b299a588249092e07aac601e]); } $this->Execute("DELETE FROM " . DB_PREFIX . "sp_config WHERE shop_id = '" . $this->escape($i6815574ea6fb0d16ca760ac76ccd5e787398426b) . "' AND config_name='optout_auto'"); $this->Execute("INSERT INTO `" . DB_PREFIX . "sp_config` (`config_name`, `config_value`, `shop_id`) VALUES ('optout_auto', '".$this->escape($i55e9f2b841df61623ce384e384e0be7f47e8c137)."', '".$this->escape($i6815574ea6fb0d16ca760ac76ccd5e787398426b)."');"); if($i7d81a14a5090d716f9bd101fd73660f7e203a168 == 1) { $this->smsProduct($i0a3adc7f4c38171232abf754e0a5bd16e3823141, $i6815574ea6fb0d16ca760ac76ccd5e787398426b, $ie4faac5815d93bef3c40ec90de63ed07d7f240b8, $ia3225bb1fa0556b70e4ad48c0617117b5a0606a2); } $this->displayConfirmation(v_smsprestashop_smscharging_saved); return self::POST_OK; } return self::POST_ERROR; } } 