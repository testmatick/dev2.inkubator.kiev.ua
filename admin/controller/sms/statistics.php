<?php define("SMS_CONTROLER_URL", DIR_APPLICATION . 'model/sms/'); require_once (defined("SMS_CONTROLER_URL")?SMS_CONTROLER_URL:"") .'smsController.php'; class ControllerSmsStatistics extends SmsController { public $dateFrom; public $dateTo; public $eshopsms = 1; public $eshopsms1 = 1; public $bulksms = 1; public $bulksms2 = 1; public $status; public function index() { $i1548a96b3354c4b6d80c8278133fdb971c700757 = new DateTime(); $this->defaultValueDefine("dateFrom", $i1548a96b3354c4b6d80c8278133fdb971c700757->format("Y-m-d") . " 00:00"); $this->defaultValueDefine("dateTo", $i1548a96b3354c4b6d80c8278133fdb971c700757->format("Y-m-d") . " 23:55"); parent::index(); } public function display() { $i02fcabda2448d40bdb76bd10f9e95950039649ee = parent::display(); $i82b103019f8b63abe35e23c8982897d7b3b13cd2 = array(1 => v_smshistory_adminsms, 2 => v_smshistory_customersms, 3 => v_smshistory_marketingsms, 4 => v_smshistory_simplesms); $i7fb9e90bc870bb7152647e673ad3beb8d1ae1a74 = array(0 => v_smshistory_status, SmsModel::STATUS_SENT => v_smshistory_sent, SmsModel::STATUS_ERROR => v_smshistory_error, SmsModel::STATUS_DELIVERED => v_smshistory_delivered, SmsModel::STATUS_BUFFERED => v_smshistory_buffered, SmsModel::STATUS_SIMULATION => v_smshistory_simulation, SmsModel::STATUS_SHEDULED => v_smshistory_sheduled, SmsModel::STATUS_DELETED => v_smshistory_deleted, SmsModel::STATUS_DND => v_smshistory_dnd, SmsModel::STATUS_DUPLICATE => v_smshistory_duplicate); $i8f43f9c1bf8a0ddd5dfab18970a3240260a57621 = $i899ac698430634790eb15bf2dae896963641d0bc = array(); $i02fcabda2448d40bdb76bd10f9e95950039649ee .= ' <h2>' . v_statistics . '</h2> <fieldset> <legend><img src="' . self::$setingsImg . '" alt="' . v_statistics . '" /> ' . v_statistics . '</legend> <form action="" method="post"> <table> <tbody> <tr> <td>' . v_statistics_datefrom . '</td> <td>' . self::getInput(array("type" => "text", "id" => "dateFrom", "name" => "dateFrom", "class" => "datetime", "value" => $this->dateFrom)) . '</td> <td>' . v_statistics_dateto . '</td> <td>' . self::getInput(array("type" => "text", "id" => "dateTo", "name" => "dateTo", "class" => "datetime", "value" => $this->dateFrom)) . '</td> <td>' . self::getSelect(array("name" => "status"), $i7fb9e90bc870bb7152647e673ad3beb8d1ae1a74, $this->status) . '</td> <td>' . self::getInput(array("type" => "checkbox", "name" => "eshopsms1", "value" => 1), $this->eshopsms1) . ' ' . v_smshistory_adminsms . '</td> <td>' . self::getInput(array("type" => "checkbox", "name" => "eshopsms", "value" => 1), $this->eshopsms) . ' ' . v_smshistory_customersms . '</td> <td>' . self::getInput(array("type" => "checkbox", "name" => "bulksms", "value" => 1), $this->bulksms) . ' ' . v_smshistory_marketingsms . '</td> <td>' . self::getInput(array("type" => "checkbox", "name" => "bulksms2", "value" => 1), $this->bulksms2) . ' ' . v_smshistory_simplesms . '</td> <td>' . self::getInput(array("type" => "submit", "name" => "submitSmsStatistics", "value" => v_smshistory_show, "class" => "button")) . '</td> </tr> </tbody> </table> </form> </fieldset> '; $i265f9877083f51df2c5f4dc474b98565cb86957f = array(); if($this->eshopsms == 1) { $i265f9877083f51df2c5f4dc474b98565cb86957f[] = 2; } if($this->eshopsms1 == 1) { $i265f9877083f51df2c5f4dc474b98565cb86957f[] = 1; } if($this->bulksms == 1) { $i265f9877083f51df2c5f4dc474b98565cb86957f[] = 3; } if($this->bulksms2 == 1) { $i265f9877083f51df2c5f4dc474b98565cb86957f[] = 4; } $ibf21559a5865d0706b08586780050d04efc951d3 = ""; if(count($i265f9877083f51df2c5f4dc474b98565cb86957f) > 0) { $ibf21559a5865d0706b08586780050d04efc951d3 = " AND type IN (" . implode(",", $i265f9877083f51df2c5f4dc474b98565cb86957f) . ")"; } $i088e5493da345fd9a50093a74c3f1d122db69ddd = ""; if($this->status > 0) { $i088e5493da345fd9a50093a74c3f1d122db69ddd = " AND status=" . $this->escape($this->status); } $if77616580e9fcb9b416b1356d92665dc4be18430 = $this->escape($this->dateFrom); $i86c5a80ebf7acc2925d2ee1234a081c514b92236 = $this->escape($this->dateTo); $i83d1339527a9dc91b02fa99420eb13b0cd47adfe = $this->Execute("SELECT count(*) as count FROM " . DB_PREFIX . "sp_sms_history where date >= '" . $if77616580e9fcb9b416b1356d92665dc4be18430 . "' AND date <= '" . $i86c5a80ebf7acc2925d2ee1234a081c514b92236 . "' " . $i088e5493da345fd9a50093a74c3f1d122db69ddd . "" . $ibf21559a5865d0706b08586780050d04efc951d3 . ""); if($i83d1339527a9dc91b02fa99420eb13b0cd47adfe->num_rows) { foreach($i83d1339527a9dc91b02fa99420eb13b0cd47adfe->rows as $i2e93e61d67c274d891066238c74ba6322d527b6d) { $ib6d2cdf28e556d600dabcd9e147fd00d396277a5 = $i2e93e61d67c274d891066238c74ba6322d527b6d['count']; } } if($ib6d2cdf28e556d600dabcd9e147fd00d396277a5 > 0) { $i02fcabda2448d40bdb76bd10f9e95950039649ee .=' <fieldset> <legend><img src="' . self::$catalogImg . '" alt="" /> ' . ucfirst(v_adminsms_jstotalsms) . " " . $ib6d2cdf28e556d600dabcd9e147fd00d396277a5 . '</legend>'; $i83d1339527a9dc91b02fa99420eb13b0cd47adfe = $this->Execute("SELECT type, count(ID) count FROM " . DB_PREFIX . "sp_sms_history WHERE date >= '" . $if77616580e9fcb9b416b1356d92665dc4be18430 . "' AND date <= '" . $i86c5a80ebf7acc2925d2ee1234a081c514b92236 . "' " . $i088e5493da345fd9a50093a74c3f1d122db69ddd . "" . $ibf21559a5865d0706b08586780050d04efc951d3 . " GROUP BY type order by ID desc"); if($i83d1339527a9dc91b02fa99420eb13b0cd47adfe->num_rows) { foreach($i83d1339527a9dc91b02fa99420eb13b0cd47adfe->rows as $i2e93e61d67c274d891066238c74ba6322d527b6d) { $i8f43f9c1bf8a0ddd5dfab18970a3240260a57621[] = "['" . $i82b103019f8b63abe35e23c8982897d7b3b13cd2[$i2e93e61d67c274d891066238c74ba6322d527b6d["type"]] . "', " . $i2e93e61d67c274d891066238c74ba6322d527b6d["count"] . "]"; } } $i83d1339527a9dc91b02fa99420eb13b0cd47adfe = $this->Execute("SELECT status, count(ID) count FROM " . DB_PREFIX . "sp_sms_history WHERE status != 2 and date >= '" . $if77616580e9fcb9b416b1356d92665dc4be18430 . "' AND date <= '" . $i86c5a80ebf7acc2925d2ee1234a081c514b92236 . "' " . $i088e5493da345fd9a50093a74c3f1d122db69ddd . "" . $ibf21559a5865d0706b08586780050d04efc951d3 . " GROUP BY status ORDER BY ID desc"); if($i83d1339527a9dc91b02fa99420eb13b0cd47adfe->num_rows) { foreach($i83d1339527a9dc91b02fa99420eb13b0cd47adfe->rows AS $i2e93e61d67c274d891066238c74ba6322d527b6d) { $i899ac698430634790eb15bf2dae896963641d0bc[] = "['" . ucfirst(mb_strtolower($i7fb9e90bc870bb7152647e673ad3beb8d1ae1a74[$i2e93e61d67c274d891066238c74ba6322d527b6d["status"]], 'UTF-8')) . "', " . $i2e93e61d67c274d891066238c74ba6322d527b6d["count"] . "]"; } } $i83d1339527a9dc91b02fa99420eb13b0cd47adfe = $this->Execute("SELECT note, status, count(ID) count FROM " . DB_PREFIX . "sp_sms_history WHERE status = 2 and date >= '" . $if77616580e9fcb9b416b1356d92665dc4be18430 . "' AND date <= '" . $i86c5a80ebf7acc2925d2ee1234a081c514b92236 . "' " . $i088e5493da345fd9a50093a74c3f1d122db69ddd . "" . $ibf21559a5865d0706b08586780050d04efc951d3 . " GROUP BY note ORDER BY ID desc"); if($i83d1339527a9dc91b02fa99420eb13b0cd47adfe->num_rows) { foreach($i83d1339527a9dc91b02fa99420eb13b0cd47adfe->rows as $i2e93e61d67c274d891066238c74ba6322d527b6d) { $i899ac698430634790eb15bf2dae896963641d0bc[] = "['" . ucfirst(mb_strtolower($i7fb9e90bc870bb7152647e673ad3beb8d1ae1a74[$i2e93e61d67c274d891066238c74ba6322d527b6d["status"]], 'UTF-8')) . " - " . trim($i2e93e61d67c274d891066238c74ba6322d527b6d["note"]) . "', " . $i2e93e61d67c274d891066238c74ba6322d527b6d["count"] . "]"; } } $i02fcabda2448d40bdb76bd10f9e95950039649ee .= ' <script type="text/javascript" src="https://www.google.com/jsapi"></script> <script type="text/javascript"> google.load("visualization", "1", {packages:["corechart"]}); google.setOnLoadCallback(drawChart); function drawChart() { ' . $this->f781eea7a3df8ddbc2f7fa3a896a85ff54c80799c("send", $i8f43f9c1bf8a0ddd5dfab18970a3240260a57621, v_smshistory_type) . ' ' . $this->f781eea7a3df8ddbc2f7fa3a896a85ff54c80799c("status", $i899ac698430634790eb15bf2dae896963641d0bc, v_smshistory_status) . ' } </script> '; $i02fcabda2448d40bdb76bd10f9e95950039649ee .= $this->f677ccd0dbc1db52913a2b1146a8f92a36db3490b("send"); $i02fcabda2448d40bdb76bd10f9e95950039649ee .= $this->f677ccd0dbc1db52913a2b1146a8f92a36db3490b("status"); } else { $i02fcabda2448d40bdb76bd10f9e95950039649ee .= ' <div> <b>' . v_smshistory_nosms . '</b> </div>'; } $i02fcabda2448d40bdb76bd10f9e95950039649ee .= '</fieldset>'; $i02fcabda2448d40bdb76bd10f9e95950039649ee .= " <script type=\"text/javascript\"> jQuery('#dateFrom').datetimepicker({ lang:'" . lang_iso_code . "', value:'" . $this->dateFrom . "' }); jQuery('#dateTo').datetimepicker({ lang:'" . lang_iso_code . "', value:'" . $this->dateTo . "' }); </script> "; return $i02fcabda2448d40bdb76bd10f9e95950039649ee; } public function postProcess($if7ac7ffb0e11bffa95681698138e923b4fd51990 = NULL, $i120dfeb2f4db76e8e52ed01ad8e678e2b9fa3bb9 = NULL, $i4df8c509b6936a0640c1594ca9b38a0a55a9562f = NULL) { if($if7ac7ffb0e11bffa95681698138e923b4fd51990 == NULL && $i120dfeb2f4db76e8e52ed01ad8e678e2b9fa3bb9 == NULL) { return self::POST_ERROR; } if(isset($i4df8c509b6936a0640c1594ca9b38a0a55a9562f['submitSmsStatistics'])) { $this->dateFrom = $this->escapePostVariables("dateFrom"); $this->dateTo = $this->escapePostVariables("dateTo"); $this->eshopsms = $this->escapePostVariables("eshopsms"); $this->eshopsms1 = $this->escapePostVariables("eshopsms1"); $this->bulksms = $this->escapePostVariables("bulksms"); $this->bulksms2 = $this->escapePostVariables("bulksms2"); $this->status = $this->escapePostVariables("status"); } return self::POST_ERROR; } private function f781eea7a3df8ddbc2f7fa3a896a85ff54c80799c($i15d84483bc094d6911ad509960fe2e79b90a34e2, $ib1199182837e705aae8d93f525c88b1184f9395d, $idbad0c3ff863f0c9103d51395248c864403ff7fb, $i1a2365847ce60d339758c6f7e468efebc92baf5a = SMS_STAT_BACK_COLOR, $i4ae693d4f265596803240f9146d4a409ef142699 = "PieChart", $i9ebf4f7e611bc678746529e484e24ea1ea77cd3d = "value") { return ' var data' . $i15d84483bc094d6911ad509960fe2e79b90a34e2 . ' = google.visualization.arrayToDataTable([ [\'SMS\', \'Count\'], ' . implode(",", $ib1199182837e705aae8d93f525c88b1184f9395d) . ' ]); var options' . $i15d84483bc094d6911ad509960fe2e79b90a34e2 . ' = { title: \'' . $idbad0c3ff863f0c9103d51395248c864403ff7fb . '\', backgroundColor: \'' . $i1a2365847ce60d339758c6f7e468efebc92baf5a . '\', pieSliceText: \'' . $i9ebf4f7e611bc678746529e484e24ea1ea77cd3d . '\', }; var chart' . $i15d84483bc094d6911ad509960fe2e79b90a34e2 . ' = new google.visualization.' . $i4ae693d4f265596803240f9146d4a409ef142699 . '(document.getElementById(\'' . $i15d84483bc094d6911ad509960fe2e79b90a34e2 . '\')); chart' . $i15d84483bc094d6911ad509960fe2e79b90a34e2 . '.draw(data' . $i15d84483bc094d6911ad509960fe2e79b90a34e2 . ', options' . $i15d84483bc094d6911ad509960fe2e79b90a34e2 . '); '; } private function f677ccd0dbc1db52913a2b1146a8f92a36db3490b($i15d84483bc094d6911ad509960fe2e79b90a34e2) { return '<div id="' . $i15d84483bc094d6911ad509960fe2e79b90a34e2 . '" style="width: 50%; height: 500px; display: inline-block;"></div>'; } } 