<?php define("SMS_CONTROLER_URL", DIR_APPLICATION . 'model/sms/'); require_once (defined("SMS_CONTROLER_URL")?SMS_CONTROLER_URL:"") .'smsController.php'; define("MAX_ROWS", 50); class ControllerSmsAnswers extends SmsController { public $year; public $month; public $filter; public function index() { $this->defaultValueDefine("year", date("Y")); $this->defaultValueDefine("month", date("m")); parent::index(); } public function ajaxReload($ib1199182837e705aae8d93f525c88b1184f9395d) { $this->defaultValueDefine("year", date("Y")); $this->defaultValueDefine("month", date("m")); $this->disableScrollUp(); $i83d1339527a9dc91b02fa99420eb13b0cd47adfe = $this->Execute("SELECT * FROM `".DB_PREFIX."sp_answers` WHERE prohlednuto = 0 LIMIT 1"); if($i83d1339527a9dc91b02fa99420eb13b0cd47adfe->num_rows) { $this->sendSnippet("output", $this->fa8faec8a8f48d841b200a6389a936889f3d90782()); } } public function display() { $i02fcabda2448d40bdb76bd10f9e95950039649ee = parent::display(); $i02fcabda2448d40bdb76bd10f9e95950039649ee .= "<script type=\"text/javascript\" src=\"" . DIR_SMS_JS . "sms.js\"></script>"; $i02fcabda2448d40bdb76bd10f9e95950039649ee .= '<div id="snippet-output">'.$this->fa8faec8a8f48d841b200a6389a936889f3d90782().'</div>'; if(count($_POST) == 0 && !isset($_GET["filter"]) && !isset($_GET["ps"])) { $i02fcabda2448d40bdb76bd10f9e95950039649ee .= '<script type="text/javascript"> setInterval( function() { jQuery.getJSON("'.$this->smsLinkAnswersReload().'"); } ,10000); </script>'; } $i02fcabda2448d40bdb76bd10f9e95950039649ee .= " <script type=\"text/javascript\"> var minus = '" . self::$minusImg . "'; var plus = '" . self::$plusImg . "'; </script> "; return $i02fcabda2448d40bdb76bd10f9e95950039649ee; } public function postProcess($if7ac7ffb0e11bffa95681698138e923b4fd51990 = NULL, $i120dfeb2f4db76e8e52ed01ad8e678e2b9fa3bb9 = NULL, $i4df8c509b6936a0640c1594ca9b38a0a55a9562f = NULL) { if($if7ac7ffb0e11bffa95681698138e923b4fd51990 == NULL && $i120dfeb2f4db76e8e52ed01ad8e678e2b9fa3bb9 == NULL) { return -1; } if(isset($if7ac7ffb0e11bffa95681698138e923b4fd51990['submitSmsAnswers'])) { $if7ac7ffb0e11bffa95681698138e923b4fd51990 = $this->escapeInput($if7ac7ffb0e11bffa95681698138e923b4fd51990); unset($if7ac7ffb0e11bffa95681698138e923b4fd51990["submitSmsAnswers"]); $this->f00209a13a49aae3cb70a784535c6e4d60b0f7a12($if7ac7ffb0e11bffa95681698138e923b4fd51990); $this->filter = base64_encode(serialize($if7ac7ffb0e11bffa95681698138e923b4fd51990)); } return -1; } private static function premadeDate($i2c0ef3bef9410f3bf64e2871a1e4a7bb4dbc7f69) { if($i2c0ef3bef9410f3bf64e2871a1e4a7bb4dbc7f69 == -1) { $i6e265112d3f62d8b9a6c1ab7809806b07dd801ad = "%"; } elseif(strlen($i2c0ef3bef9410f3bf64e2871a1e4a7bb4dbc7f69) == 1) { $i6e265112d3f62d8b9a6c1ab7809806b07dd801ad = "0" . $i2c0ef3bef9410f3bf64e2871a1e4a7bb4dbc7f69; } else { $i6e265112d3f62d8b9a6c1ab7809806b07dd801ad = $i2c0ef3bef9410f3bf64e2871a1e4a7bb4dbc7f69; } return $i6e265112d3f62d8b9a6c1ab7809806b07dd801ad; } private function f50fd73a826539c3515099ad606f8e83a2fab7d52($ib1199182837e705aae8d93f525c88b1184f9395d) { $this->filter = $_GET["filter"]; $id6df7fb626ea7dcb74a3aeaed55471bda0715fc1 = unserialize(base64_decode($ib1199182837e705aae8d93f525c88b1184f9395d)); $this->f00209a13a49aae3cb70a784535c6e4d60b0f7a12($id6df7fb626ea7dcb74a3aeaed55471bda0715fc1); } private function f00209a13a49aae3cb70a784535c6e4d60b0f7a12($id6df7fb626ea7dcb74a3aeaed55471bda0715fc1) { $this->year = $id6df7fb626ea7dcb74a3aeaed55471bda0715fc1["year"]; $this->month = $id6df7fb626ea7dcb74a3aeaed55471bda0715fc1["month"]; } private function fa8faec8a8f48d841b200a6389a936889f3d90782() { $i02fcabda2448d40bdb76bd10f9e95950039649ee = ""; if(isset($_GET["filter"]) && $_GET["filter"] != "" && $this->filter == null) { $this->f50fd73a826539c3515099ad606f8e83a2fab7d52($_GET["filter"]); } $i02fcabda2448d40bdb76bd10f9e95950039649ee .= ' <h2>' . v_smsanswers_smsanswers . '</h2><p>' . v_smsanswers_description . '</p> <fieldset> <legend><img src="' . self::$setingsImg . '" alt="' . v_smsanswers_smsanswers . '" /> ' . v_smsanswers_smsanswers . '</legend> <form action="" method="post"> <table> <tbody> <tr> <td>' . self::getSelect(array("name" => "year"), self::generateNumbers(2013, date("Y"), false, v_smsanswers_year, 0), $this->year) . '</td> <td>' . self::getSelect(array("name" => "month"), self::generateNumbers(1, 12, false, v_smsanswers_month, -1), $this->month) . '</td> <td>' . self::getInput(array("type" => "submit", "name" => "submitSmsAnswers", "value" => v_smsanswers_show, "class" => "button")) . '</td> </tr> </tbody> </table> </form> </fieldset> '; if(!$this->year) { $this->year = "%"; } $ifb929ad5eeb56e937309ced13ce40ee86bbcacb5 = self::premadeDate($this->month); $ie5b0dc673ae7185f8cfea133baf9fef6a88b3281 = "WHERE cas LIKE '" . $this->escape($this->year . "-" . $ifb929ad5eeb56e937309ced13ce40ee86bbcacb5 . "-%") . "'"; $i83d1339527a9dc91b02fa99420eb13b0cd47adfe = $this->Execute("SELECT count(*) count FROM " . DB_PREFIX . "sp_answers " . $ie5b0dc673ae7185f8cfea133baf9fef6a88b3281 . ""); if($i83d1339527a9dc91b02fa99420eb13b0cd47adfe->num_rows) { foreach($i83d1339527a9dc91b02fa99420eb13b0cd47adfe->rows as $i2e93e61d67c274d891066238c74ba6322d527b6d) { $ib6d2cdf28e556d600dabcd9e147fd00d396277a5 = $i2e93e61d67c274d891066238c74ba6322d527b6d['count']; } } $if6cc45dd5b6ded71a17949f208a9712f4351c6ba = new Paginator($ib6d2cdf28e556d600dabcd9e147fd00d396277a5, MAX_ROWS, ((isset($_GET["ps"])) ? $_GET["ps"] : 1), $this->smsLinkPageSave($this->filter)); if($ib6d2cdf28e556d600dabcd9e147fd00d396277a5 > 0) { $i02fcabda2448d40bdb76bd10f9e95950039649ee .=' <fieldset> <legend><img src="' . self::$catalogImg . '" alt="" /> ' . v_smsanswers_results . ($if6cc45dd5b6ded71a17949f208a9712f4351c6ba->offset + 1) . " - " . ((($if6cc45dd5b6ded71a17949f208a9712f4351c6ba->offset + $if6cc45dd5b6ded71a17949f208a9712f4351c6ba->limit) <= ($if6cc45dd5b6ded71a17949f208a9712f4351c6ba->num_results)) ? ($if6cc45dd5b6ded71a17949f208a9712f4351c6ba->offset + $if6cc45dd5b6ded71a17949f208a9712f4351c6ba->limit) : $if6cc45dd5b6ded71a17949f208a9712f4351c6ba->num_results) . v_smsanswers_of . $if6cc45dd5b6ded71a17949f208a9712f4351c6ba->num_results . ' ' . v_smsanswers_sms . '</legend>'; $i02fcabda2448d40bdb76bd10f9e95950039649ee .= " <table class=\"resultTable\"> <thead> <tr> <th class=\"left\">" . v_smsanswers_number . "</th> <th class=\"w150\">" . v_smsanswers_date . "</th> <th class=\"w200\">" . v_smsanswers_smscenter . "</th> <th class=\"w100\"></th> </tr> </thead> <tbody> "; $ife90ec3ee83cd90f9098beed08a011650ddba7e7 = "SELECT * FROM " . DB_PREFIX . "sp_answers " . $ie5b0dc673ae7185f8cfea133baf9fef6a88b3281 . " ORDER BY ID DESC LIMIT " . $this->escape($if6cc45dd5b6ded71a17949f208a9712f4351c6ba->offset) . "," . $this->escape($if6cc45dd5b6ded71a17949f208a9712f4351c6ba->limit) . ""; $i83d1339527a9dc91b02fa99420eb13b0cd47adfe = $this->Execute($ife90ec3ee83cd90f9098beed08a011650ddba7e7); if($i83d1339527a9dc91b02fa99420eb13b0cd47adfe->num_rows) { foreach($i83d1339527a9dc91b02fa99420eb13b0cd47adfe->rows as $i2e93e61d67c274d891066238c74ba6322d527b6d) { if(strlen($i2e93e61d67c274d891066238c74ba6322d527b6d['smsc'] > 0)) { $i03f51a10206b19214ffa5a9a6a13c273283dd661 = "+" . trim($i2e93e61d67c274d891066238c74ba6322d527b6d['smsc']); } else { $i03f51a10206b19214ffa5a9a6a13c273283dd661 = "-"; } if(!$i2e93e61d67c274d891066238c74ba6322d527b6d['prohlednuto']) { $id766a19a2ca70a97dc08ea7a3c5496a3fc59d0a0 = "<span class=\"blink\">" . v_smsanswers_new . "</span> "; } else { $id766a19a2ca70a97dc08ea7a3c5496a3fc59d0a0 = ""; } if(strlen($i2e93e61d67c274d891066238c74ba6322d527b6d["from"]) > 1) { $i6de5513d7bf66573dedf3f2f853ce5457a8f957f = htmlspecialchars($i2e93e61d67c274d891066238c74ba6322d527b6d["from"]); } else { $i6de5513d7bf66573dedf3f2f853ce5457a8f957f = v_adminsmsprofile_invalidnumber; } $i02fcabda2448d40bdb76bd10f9e95950039649ee .= " <tr " . self::isEven($i0018d0cb00e9a7ab65cdbd7f1c6b001b1e0222a6, "even") . "> <td> <a id=\"displayText" . $i2e93e61d67c274d891066238c74ba6322d527b6d['ID'] . "\" href=\"javascript:\" onclick=\"toggleInfo(" . $i2e93e61d67c274d891066238c74ba6322d527b6d['ID'] . ");\"> <img src='" . self::$plusImg . "' id=\"toggleButton" . $i2e93e61d67c274d891066238c74ba6322d527b6d['ID'] . "\"/> " . $i6de5513d7bf66573dedf3f2f853ce5457a8f957f . " </a> </td> <td class=\"center\">" . $i2e93e61d67c274d891066238c74ba6322d527b6d['cas'] . "</td> <td class=\"center\">" . $i03f51a10206b19214ffa5a9a6a13c273283dd661 . "</td> <td class=\"center\">" . $id766a19a2ca70a97dc08ea7a3c5496a3fc59d0a0 . "</td> </tr> <tr id=\"toggleText" . $i2e93e61d67c274d891066238c74ba6322d527b6d['ID'] . "\" class=\"hidden\"> <td colspan=6><b>" . v_smsanswers_text . "</b><br /><pre>" . htmlspecialchars($i2e93e61d67c274d891066238c74ba6322d527b6d['text']) . "</pre></td> </tr> "; } } $i02fcabda2448d40bdb76bd10f9e95950039649ee .= " <tbody> </table> "; $i02fcabda2448d40bdb76bd10f9e95950039649ee .= $if6cc45dd5b6ded71a17949f208a9712f4351c6ba; $this->Execute("UPDATE " . DB_PREFIX . "sp_answers SET prohlednuto = '1'"); } else { $i02fcabda2448d40bdb76bd10f9e95950039649ee .= '<div><strong>' . v_smsanswers_nosms . '</strong></div>'; } $i02fcabda2448d40bdb76bd10f9e95950039649ee .= '</fieldset>'; return $i02fcabda2448d40bdb76bd10f9e95950039649ee; } } 